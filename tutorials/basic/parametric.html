

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Paramaterizing Models &mdash; fish2eod 0.1.0b documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Solving" href="solving.html" />
    <link rel="prev" title="Domains" href="domains.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> fish2eod
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="basic_tutorials.html">Basic Tutorials</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="theory.html">Theory</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html">Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="geometry.html">Geometry</a></li>
<li class="toctree-l3"><a class="reference internal" href="domains.html">Domains</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Paramaterizing Models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parameterizing-functions">Parameterizing Functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#fish-position-parameters">Fish Position Parameters</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="solving.html">Solving</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../plotting/plotting_tutorials.html">Plotting Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../advanced/advanced_tutorials.html">Advanced Tutorials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../examples/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/fish2eod.html">fish2eod package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">fish2eod</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
          <li><a href="basic_tutorials.html">Basic Tutorials</a> &raquo;</li>
        
      <li>Paramaterizing Models</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/tutorials/basic/parametric.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="paramaterizing-models">
<h1>Paramaterizing Models<a class="headerlink" href="#paramaterizing-models" title="Permalink to this headline">¶</a></h1>
<p>This tutorial assumes that you’ve already read the <a class="reference internal" href="domains.html"><span class="doc">domains tutorial</span></a>.</p>
<p>Generally speaking you will never make one model. You may be interested in multiple object conductances or object
locations. Instead of making 10 models for each object you can simply parameterize them.</p>
<div class="section" id="parameterizing-functions">
<h2>Parameterizing Functions<a class="headerlink" href="#parameterizing-functions" title="Permalink to this headline">¶</a></h2>
<p>There are 3 parameterizable methods in the <a class="reference internal" href="../../api/fish2eod.html#fish2eod.models.BaseFishModel" title="fish2eod.models.BaseFishModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseFishModel</span></code></a></p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="../../api/fish2eod.html#fish2eod.models.BaseFishModel.add_geometry" title="fish2eod.models.BaseFishModel.add_geometry"><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_geometry</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/fish2eod.html#fish2eod.models.BaseFishModel.add_voltage_sources" title="fish2eod.models.BaseFishModel.add_voltage_sources"><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_voltage_sources</span></code></a></p></li>
<li><p><a class="reference internal" href="../../api/fish2eod.html#fish2eod.models.BaseFishModel.add_current_sources" title="fish2eod.models.BaseFishModel.add_current_sources"><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_current_sources</span></code></a></p></li>
</ol>
<p>These methods have the same default signature</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">method_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
 <span class="n">IMPLEMENTATION</span><span class="o">-</span><span class="n">HERE</span>
</pre></div>
</div>
<p>If we want to add parameters we can put them anywhere between <code class="docutils literal notranslate"><span class="pre">self</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code></p>
<p>For example here we’re going to make a model with a movable object by defining its x, and y position parametrically</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">fish2eod</span> <span class="kn">import</span> <span class="n">BaseFishModel</span><span class="p">,</span> <span class="n">Circle</span>


<span class="k">class</span> <span class="nc">ParametricObject</span><span class="p">(</span><span class="n">BaseFishModel</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object_x</span><span class="p">,</span> <span class="n">object_y</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">([</span><span class="n">object_x</span><span class="p">,</span> <span class="n">object_y</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">model_geometry</span><span class="o">.</span><span class="n">add_domain</span><span class="p">(</span><span class="s2">&quot;object_domain&quot;</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">ParametricObject</span><span class="p">()</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Create the model with parameters</span>

<span class="sd">fish_x = [0, 10]</span>
<span class="sd">fish_y = [0,0]</span>

<span class="sd">This defines a fish spine running with two points on it - (0,0) and (10, 0).</span>

<span class="sd">Additionally we will define</span>

<span class="sd">object_x = 2</span>
<span class="sd">object_y = 10</span>

<span class="sd">which creates an object at (2, 10) per our model implementation</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fish_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s2">&quot;fish_y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;object_x&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;object_y&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>  <span class="c1"># shorthand for extracting each term from the dictionary</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot_geometry</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">We can re-do this but now with a different object location of (10, 10) by updating our parameters</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fish_x&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="s2">&quot;fish_y&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;object_x&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;object_y&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
<span class="c1"># additionally since fish_x, and fish_y are not changing</span>
<span class="c1"># we could have just done parameters[&#39;object_x&#39;] = 10</span>

<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot_geometry</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../../tutorials/basic/code/parametric_object.py">Source code</a>)</p>
<div class="figure align-default" id="id1">
<img alt="../../_images/parametric_object_00.png" src="../../_images/parametric_object_00.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href="../../tutorials/basic/code/parametric_object_00.png">png</a>, <a class="reference external" href="../../tutorials/basic/code/parametric_object_00.hires.png">hires.png</a>, <a class="reference external" href="../../tutorials/basic/code/parametric_object_00.pdf">pdf</a>)</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<div class="figure align-default" id="id2">
<img alt="../../_images/parametric_object_01.png" src="../../_images/parametric_object_01.png" />
<p class="caption"><span class="caption-text">(<a class="reference external" href="../../tutorials/basic/code/parametric_object_01.png">png</a>, <a class="reference external" href="../../tutorials/basic/code/parametric_object_01.hires.png">hires.png</a>, <a class="reference external" href="../../tutorials/basic/code/parametric_object_01.pdf">pdf</a>)</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>As you can see we’ve added two parameters to the model <code class="docutils literal notranslate"><span class="pre">object_x</span></code> and <code class="docutils literal notranslate"><span class="pre">object_y</span></code>. We set parameters with a parameter
dictionary with all necessary parameters included in it. The <a class="reference internal" href="../../api/fish2eod.html#fish2eod.models.BaseFishModel" title="fish2eod.models.BaseFishModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BaseFishModel</span></code></a> has two required parameters: <code class="docutils literal notranslate"><span class="pre">fish_x</span></code>
and <code class="docutils literal notranslate"><span class="pre">fish_y</span></code>. These two parameters are lists of points which define the x and y coordinates of the spine. For this
model we’ve added two additional parameters and therefore they’re also included in the dictionary. You can have as many
or as few as you’d like. For example the radius could also be parameterized.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>While this example only showed how to work with geometry. The process for <a class="reference internal" href="../../api/fish2eod.html#fish2eod.models.BaseFishModel.add_voltage_sources" title="fish2eod.models.BaseFishModel.add_voltage_sources"><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_voltage_sources</span></code></a> or
<a class="reference internal" href="../../api/fish2eod.html#fish2eod.models.BaseFishModel.add_current_sources" title="fish2eod.models.BaseFishModel.add_current_sources"><code class="xref py py-obj docutils literal notranslate"><span class="pre">add_current_sources</span></code></a> is identical. Parameter names are placed between <code class="docutils literal notranslate"><span class="pre">self</span></code> and <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>.</p>
<p>As an additional note: the same parameter can be used in more than one place just by adding the same name. You do not
need to redefine parameters.</p>
</div>
</div>
<div class="section" id="fish-position-parameters">
<h2>Fish Position Parameters<a class="headerlink" href="#fish-position-parameters" title="Permalink to this headline">¶</a></h2>
<p>The only requirement for the points is that they are in rostro-caudal order and the midline does not self-intersect.</p>
<p>To highlight the flexibility we will create a 45cm fish with it’s head at (-30, -30), an exponential body, and rotated
by 45°.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Example where we show how to set arbitrary coordinates.&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">fish2eod</span> <span class="kn">import</span> <span class="n">BaseFishModel</span>


<span class="k">def</span> <span class="nf">compute_coordinates</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Compute rotated coordinates for a fish at 45cm fish at  45 degrees with an exponential curve.&quot;&quot;&quot;</span>

    <span class="c1"># x from -30 to 15</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

    <span class="c1"># y has a subtle exponential bend</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mi">30</span><span class="p">)</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">30</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span>  <span class="c1"># join x and y</span>

    <span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)],</span>
        <span class="p">]</span>
    <span class="p">)</span>  <span class="c1"># 45deg rotation matrix</span>

    <span class="c1"># apply rotation</span>
    <span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">xy</span> <span class="o">+</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="n">rot</span><span class="p">)</span> <span class="o">-</span> <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>

    <span class="c1"># extract x and y coordinates</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>


<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Define model parameters.</span>

<span class="sd">Here the parameters set a fish with a head at -30cm and tail at 15cm then rotated 45degrees</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">x_new</span><span class="p">,</span> <span class="n">y_new</span> <span class="o">=</span> <span class="n">compute_coordinates</span><span class="p">()</span>
<span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;fish_x&quot;</span><span class="p">:</span> <span class="n">x_new</span><span class="p">,</span> <span class="s2">&quot;fish_y&quot;</span><span class="p">:</span> <span class="n">y_new</span><span class="p">}</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Create the model and compile it</span>

<span class="sd">Plot the subdomains afterwards</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">BaseFishModel</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="o">**</span><span class="n">parameters</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot_domains</span><span class="p">()</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../../tutorials/basic/code/base_fish_model_fish_position.py">Source code</a>, <a class="reference external" href="../../tutorials/basic/code/base_fish_model_fish_position.png">png</a>, <a class="reference external" href="../../tutorials/basic/code/base_fish_model_fish_position.hires.png">hires.png</a>, <a class="reference external" href="../../tutorials/basic/code/base_fish_model_fish_position.pdf">pdf</a>)</p>
<div class="figure align-default">
<img alt="../../_images/base_fish_model_fish_position.png" src="../../_images/base_fish_model_fish_position.png" />
</div>
<p>While this code may look complicated, the majority of the code is purely used to compute the coordinates for the fish
body. All of the <code class="docutils literal notranslate"><span class="pre">compute_coordinates</span></code> function is doing that role.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="solving.html" class="btn btn-neutral float-right" title="Solving" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="domains.html" class="btn btn-neutral float-left" title="Domains" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, Aaron R. Shifman, John E. Lewis

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>